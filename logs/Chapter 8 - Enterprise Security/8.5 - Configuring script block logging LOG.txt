# 8.5 - Configuring Script Block Logging

# Run on SRV1



# 1. Clear PowerShell Core operational log


NO OUTPUT

# 2. Enableling script block logging



NO OUTPUT



PS C:\Foo> # 3. Examining logs for 4104 events
PS C:\Foo> Get-Winevent -LogName 'PowerShellCore/Operational' |
             Where-Object id -eq 4104 |
               Select-Object -First 1 |
                 Format-List -Property ID, Logname, Message

Id      : 4104
LogName : PowerShellCore/Operational
Message : Creating Scriptblock text (1 of 1):
          # 2. Enablling script block logging
          $SBLPath = 'HKLM:\Software\Policies\Microsoft\Windows' +
                       '\PowerShell\ScriptBlockLogging'
          if (-not (Test-Path $SBLPath))  {
                  $null = New-Item $SBLPath -Force
              }
          Set-ItemProperty $SBLPath -Name EnableScriptBlockLogging -Value "1"

          ScriptBlock ID: f650b9b7-b459-43a8-8a3d-95880c530d6b
          Path: 




# 4. Creating another script block that is not logged



NO OUTPUT




PS C:\Foo> # 5. Comparing before and after
PS C:\Foo> "Before:  $($Before.Count) events"
PS C:\Foo> "After :  $($After.Count) events"
Before:  1 events
After :  1 events


